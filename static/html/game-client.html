<html>
  <body>
    <script src="http://localhost:9810/compile?id=client"></script>
    <script>
      var _ = ble.telephone_pictionary;
      var url = location.toString();
      url = url.replace(/\/[^\/]*$/, '/');
      var client = new _.ClientImpl(url);
      var game = new _.GameImpl(client);
      var fetchRequest = game.fetchState();
      var comet = new ble.net.QueryTimeComet(url + 'events');
      fetchRequest.wait(function(result) {
        if(result.getError() !== undefined) {
          console.error(result.getError());
          return;
        }
        var value = result.getValue();
        var time = value['lastTime'];
        if(time === undefined) {
          console.error('didn\'t get a time');
          return
        }

        console.log(value);
        comet.runAt(time);
      });
    </script>
  </body>
</html>
